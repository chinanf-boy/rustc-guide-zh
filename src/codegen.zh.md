# 代码生成

代码生成或“codegen”是编译器中实际生成可执行二进制文件的部分。rustc使用llvm生成代码。

> 注意：如果要查找有关如何调试代码生成错误的提示，请参见[调试章节的这一部分][debug].

[debug]: compiler-debugging.html#debugging-llvm

## 什么是LLVM？

本指南前面的所有章节都有一个共同点：我们根本没有生成任何可执行的机器代码！在这一章中，所有这些都发生了变化。

与大多数编译器一样，rustc由“前端”和“后端”组成。“前端”负责获取原始源代码，检查其正确性，并将其转换为格式。`X`从中我们可以生成可执行的机器代码。然后“后端”采用这种格式`X`并为某些平台生成（可能优化）可执行机器代码。前面的所有章节都讨论了Rustc的前端。

Rustc的后端是[LLVM](https://llvm.org)“模块化和可重用编译器和工具链技术的集合”。特别是，LLVM项目包含一个可插入的编译器后端（也称为“LLVM”），许多编译器项目都使用它，包括`clang`C编译器和我们的爱人`rustc`.

LLVM的“格式”`X`“被称为llvm ir。它基本上是带有附加的低级类型和注释的汇编代码。这些注释有助于对llvm ir和输出的机器代码进行优化。所有这些的最终结果是（最终）某种可执行的东西（例如，一个ELF对象或WASM）。

使用LLVM有一些好处：

-   我们不需要编写完整的编译器后端。这减少了实施和维护负担。
-   我们受益于LLVM项目收集的大量高级优化。
-   我们可以自动编译Rust到LLVM支持的任何平台。例如，只要LLVM添加了对WASM的支持，就可以了！Rustc、Clang和其他一些语言都能编译成WASM！（好吧，还有一些额外的事情要做，但是我们90%都在那里）。
-   我们和其他编译器项目彼此受益。例如，当[幽灵和崩溃安全漏洞][spectre]被发现，只需要修补LLVM。

[spectre]: https://meltdownattack.com/

## 生成llvm-ir

托多
