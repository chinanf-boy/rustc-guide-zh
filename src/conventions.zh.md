该文件提供了，有关 rustc 编码惯例的一些提示。本章包括[格式化](#formatting)，[编码正确性](#cc)，[使用来自 crates.io 的箱子](#cio)，以及一些[结构化您的 PR，以便于审核](#er)提示。

<a name="formatting"></a>

# 格式化和整洁的脚本

rustc 慢慢驶向[Rust 标准编码风格][fmt]; 然而，此刻，更多的是，*混乱的*样式。我们确实有一些强制的格式惯例，这些惯例由我们亲切地称为“整洁(tidy)”的脚本，自动强制执行。当你`./x.py test`时，整洁的脚本会自动运行，并且可以与`./x.py test src/tools/tidy`分开运行。

[fmt]: https://github.com/rust-lang-nursery/fmt-rfcs

<a name="copyright"></a>

### 版权声明

某些现有文件，以版权和许可声明开头。对于根据标准条款（双条款 MIT/Apache-2.0）许可的新文件，请忽略此通知。对于现有文件，顶部的年份没有意义：从作者身份开始，版权保护条款实际上是自动。我们通常不会在现有文件上编辑年份。

## 单行长

单行最多 100 个字符。如果你可以保持 80，那就更好了。

**忽略行长度限制。**有时 - 特别是对于测试 - 可能有必要免除此限制。在这种情况下，您可以在文件顶部，添加注释（在版权声明之后），如下所示：

```rust
// ignore-tidy-linelength
```

## Tabs vs spaces

更喜欢 4 个空格的缩进。

<a name="cc"></a>

# 编码的正确性

除了格式化之外，还有一些值得关注的其他提示。

## 喜欢详尽的 matchs

运用`_`在匹配(match)中很方便，但这意味着，当新的变体添加到枚举时，它们可能无法正确处理。问问自己：如果在这个枚举中添加了一个新的变体，与其他相比，它有想要使用`_`代码的机会吗？除非，答案是“少”机会，否则详尽的匹配更好。（同样的建议，用于`if let`和`while let`，这是对单个变体的有效测试。）

## 对于您不想忘记的事情，请使用“TODO”注释

作为一个有用的工具，在提交 PR 前，你可以给想要搞定的事情，插入一个`// TODO`注释，：

```rust,ignore
fn do_something() {
    if something_else {
        unimplemented!(); // TODO write this
    }
}
```

整洁的脚本将报告错误`// TODO`注释，所以这个 PR 代码在修复（或删除）TODO 之前，无法'登岛'。

这在 PR 中也很有用，因为它可以从一个提交(commit)中发出信号，如：告知您留给未来的提交，要修复的错误：

```rust,ignore
if foo {
    return true; // TODO wrong, 保证下个提交会修复，加油未来的你
}
```

<a name="cio"></a>

# 使用来自 crates.io 的箱

允许使用 crates.io 中的箱子，但不应无偿添加外部依赖项。所有这些箱必须具有适当的许可证。有一个自动检查，Cargo 的相关元数据，以确保这一点。

<a name="er"></a>

# 如何结构化您的 PR

如何准备 PR 中的提交，可以为审查员带来大大不同的视觉效果。这里有一些提示。

**将“纯重构(pure refactorings)”分开，变为各自的提交。**例如，如果重命名方法，则将该重命名放入其自己的提交中，同时重命名所有的用法。

**更多提交通常更好。**如果你正在进行大的改变，那么将它分解成可以独立，好理解的较小步骤，(几乎)总是更好。需要注意的一件事是，如果您在一个策略之后，引入一些代码，那么在稍后的提交中，将其显使更改（而不是添加到它），不然“来来去去(back-and-forth)”可能会让人感到困惑。

**如果您运行 rustfmt ，但文件尚未格式化，请将其隔离到自己的提交中。**这与之前的规则非常相似，但同样值得强调。rustfmt (格式化)文件是可以的，但由于我们目前不会一直运行 rustfmt，这会给你的提交带来很多'噪音'。请将其隔离到自己的提交中。这也使得 rebase 不那么痛苦，因为 rustfmt 往往会导致很多合并冲突，并且将那些‘渣渣’，分到自己的提交，会使得它们更容易解决。

**没有合并。**除了 bors(机器人) 之外，我们不允许将合并(merge)提交到我们的 Git 历史。如果你遇到合并冲突，可以通过`git rebase -i rust-lang/master`命令来变基（假设你 remote 使用这个`rust-lang`名字）。

**个人提交不必构建（但这很好）。**我们不要求每个中间提交，都成功构建 - 我们只希望能够在 PR 级别上，区别对待。但是，如果你*能够*让个人提交，成功构建压缩，这总是有帮助的。
