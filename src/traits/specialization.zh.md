# 专业化

**托多**粉笔放在哪里？我们应该在这里提到/讨论它吗？

定义在`specialize`模块。

基本策略是建立一个*专业化图*在一致性检查期间（回想一下一致性检查寻找重叠的impl）。插入到图中可以找到在专门化层次结构中放置IMPL的正确位置；如果没有正确的位置（由于部分重叠但没有包含），则会出现重叠错误。在选择IMPL时咨询专门化（当然），在沿着专门化层次结构传播默认值时咨询图形。

您可能期望在选择期间使用专门化图，即实际执行专门化时。这不是因为两个原因：

-   这仅仅是一种优化：给定一组适用的候选者，我们可以通过直接比较它们来进行专业化，而不是查阅图表来确定最专业化的候选者。考虑到我们也缓存了选择的结果，这种优化的好处是值得怀疑的。

-   为了首先构建专门化图，我们需要使用选择（因为我们需要确定一个IMPL是否专门化另一个IMPL）。处理这种可重入性需要一些额外的模式开关来进行选择。考虑到似乎没有足够的理由使用这个图，我们坚持使用一种更简单的选择方法，并且只将这个图用于传播默认实现。

特征impl选择可以成功，即使多个impl可以应用，只要它们是同一个专门化家族的一部分。在这种情况下，它返回*单一的*成功时的impl–这是最专业的impl*已知的*申请。但是，如果有任何推理变量在起作用，返回的impl可能不是我们在trans时将使用的实际impl。因此，我们特别注意避免投影关联类型，除非（1）关联类型不使用`default`因此，不能重写或（2）具体地知道所有输入类型。

## 其他资源

[这次谈话][talk]通过@sunjay可能会有用。请记住，本次演讲只对问题和解决方案进行了全面的概述（在@sunjay的工作进行到一半的时候进行了介绍）。另外，它是在2018年6月发布的，一些事情可能在你观看时发生了变化。

[talk]: https://www.youtube.com/watch?v=rZqS4bLPL24
